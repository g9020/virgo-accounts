DATE	;GRI,,,;12:27 PM  19 Jan 1999
	;=======================================================
	; Date and Time Routines
	;
	; Copyright Graham R Irwin 1993-9
	;
	;=======================================================

	; 21549 = 31/12/1899
	; 21608 = 28/02/1900
	; 21914 = 31/12/1900

	;Usual entry point - Get today's date and time
	S %Y=$H-21549\365.25,%D=$H-21914-(%Y-1*365.25\1),%M=1
	I $H<21550 S %D=%D+365,%Y=%Y-1
	F %F=31,%Y#4=0&%Y+28,31,30,31,30,31,31,30,31,30 Q:%D'>%F  S %D=%D-%F,%M=%M+1
	S:$L(%D)=1 %D=0_%D S:$L(%M)=1 %M=0_%M S %Y=1900+%Y S DAT=%D_"/"_%M_"/"_%Y K %M,%D,%Y,%F
	I $H["," S %MI=$P($H,",",2)\60,TIM=$e(%MI\60+100,2,3)_":"_$e(%MI#60+100,2,3) K %MI
	Q

	;Convert $H format to DD/MM/YYYY
H2DMY	S:'$D(%H) %H=$H
	S %Y=%H-21549\365.25,%D=%H-21914-(%Y-1*365.25\1),%M=1
	I %H<21550 S %D=%D+365,%Y=%Y-1
	F %F=31,%Y#4=0&%Y+28,31,30,31,30,31,31,30,31,30 Q:%D'>%F  S %D=%D-%F,%M=%M+1
	S:$L(%D)=1 %D=0_%D S:$L(%M)=1 %M=0_%M S %Y=1900+%Y S %DAT=%D_"/"_%M_"/"_%Y K %M,%D,%Y,%F
	I %H["," S %MI=$P(%H,",",2)\60,TIM=$e(%MI\60+100,2,3)_":"_$e(%MI#60+100,2,3) K %MI
	K %H Q

	;Convert DD/MM/YY to $H format
DMY2H	S %D=+%DAT,%M=$P(%DAT,"/",2),%Y=$P(%DAT,"/",3)-1900,%H=365.25*$S(%M>2:%Y+60,1:%Y+59)\1+(30.6*$S(%M>2:%M+1,1:%M+13)\1)+%D-428 S:%H>21608 %H=%H-1 K %M,%D,%Y Q
